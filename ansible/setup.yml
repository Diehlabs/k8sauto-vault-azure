---
- hosts:
    all

  tasks:
    - name: Install Vault
      include_tasks: vault_install.yml

    - name: Distribute vault hcl config file to all nodes
      ansible.builtin.template:
        src: ./etc-vault.d-vault.hcl.j2
        dest: /etc/vault.d/vault.hcl

    - name: Manage the Vault service
      ansible.builtin.service:
        name: vault
        state: started
        enabled: yes

    # https://learn.hashicorp.com/tutorials/vault/raft-deployment-guide?in=vault/day-one-raft#prepare-tls-certificates
